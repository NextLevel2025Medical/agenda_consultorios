{% extends "base.html" %}
{% block content %}

<div class="card max-w-3xl">
  <h2 class="text-2xl font-semibold text-slate-100 mb-1">
    Bloqueios de Agenda
  </h2>
  <p class="text-slate-400 mb-6">
    Cadastre bloqueios para impedir agendamentos em dias especÃ­ficos.
  </p>

  <form method="post" action="/bloqueios" class="grid gap-4">

    <div>
      <label class="block text-sm text-slate-300 mb-1">Data</label>
      <input
        type="date"
        name="data"
        class="input w-full"
        required
      >
    </div>

    <div>
      <label class="block text-sm text-slate-300 mb-1">Motivo</label>
      <input
        type="text"
        name="motivo"
        class="input w-full"
        placeholder="Ex: Feriado, Viagem, Congresso"
        required
      >
    </div>

    <div>
      <label class="block text-sm text-slate-300 mb-1">Profissional</label>
      <select name="profissional" class="input w-full" required>
        <option value="todos">Todos</option>
        {% for s in surgeons %}
          <option value="{{ s.id }}">{{ s.full_name }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="pt-2">
      <button type="submit" class="btn-primary w-56">
        Salvar bloqueio
      </button>
    </div>
  </form>

  <div class="mt-10">
    <h3 class="text-lg font-semibold text-slate-100 mb-3">
      Bloqueios cadastrados
    </h3>

    {% if blocks and blocks|length > 0 %}
      <div class="grid gap-3">
        {% for b in blocks %}
          <div class="rounded-xl border border-slate-700 bg-slate-900/40 px-4 py-3">
            <div class="flex justify-between items-center">
              <div>
                <div class="text-slate-100 font-semibold">
                  {{ b.day.strftime("%d/%m/%Y") }}
                </div>

                <div class="text-slate-300 text-sm">
                  {{ b.reason }} â€”
                  {% if b.applies_to_all %}
                    Todos os profissionais
                  {% else %}
                    {% set found = false %}
                    {% for s in surgeons %}
                      {% if s.id == b.surgeon_id %}
                        {{ s.full_name }}
                        {% set found = true %}
                      {% endif %}
                    {% endfor %}
                    {% if not found %}Profissional{% endif %}
                  {% endif %}
                </div>
              </div>

              <span class="text-red-400 text-xl">ðŸ”’</span>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-slate-400">
        Nenhum bloqueio cadastrado ainda.
      </p>
    {% endif %}
  </div>
</div>

{% endblock %}
